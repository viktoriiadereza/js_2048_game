const t=new class{constructor(t=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.initialState=t,this.copeInitialState=t.map(t=>[...t]),this.board=this.copyState(this.copeInitialState),this.status="idle",this.score=0,this.moved=!1}copyState(t){return t.map(t=>[...t])}getState(){return this.board}getScore(){return this.score}getStatus(){return this.status}moveLeft(){if("playing"!==this.status)return;let t=this.board.map(t=>this.processRow(t));this.handleMove(t)}moveRight(){if("playing"!==this.status)return;let t=this.board.map(t=>this.processRowRight(t));this.handleMove(t)}moveUp(){if("playing"!==this.status)return;let t=this.transpose(this.board).map(t=>this.processRow(t));this.handleMove(this.transpose(t))}moveDown(){if("playing"!==this.status)return;let t=this.transpose(this.board).map(t=>this.processRowRight(t));this.handleMove(this.transpose(t))}handleMove(t){this.isBoardChanged(this.board,t)?(this.board=t,this.addRandomCell(),this.checkWin(),this.checkGameOver(),this.moved=!0):this.moved=!1}start(){"idle"===this.status&&(this.status="playing",this.addRandomCell(),this.addRandomCell())}restart(){this.board=this.copyState(this.copeInitialState),this.score=0,this.status="idle",this.moved=!1;let t=document.querySelector(".message-lose");t&&t.classList.add("hidden")}addRandomCell(){let t=[];for(let e=0;e<4;e++)for(let s=0;s<4;s++)0===this.board[e][s]&&t.push({row:e,col:s});if(t.length>0){let{row:e,col:s}=t[Math.floor(Math.random()*t.length)];this.board[e][s]=.1>Math.random()?4:2,this.animateCell(e,s)}}processRow(t){let e=t.filter(t=>0!==t);for(let t=0;t<e.length-1;t++)e[t]===e[t+1]&&(e[t]*=2,this.score+=e[t],e.splice(t+1,1));for(;e.length<4;)e.push(0);return e}processRowRight(t){let e=[...t].reverse();return this.processRow(e).reverse()}checkGameOver(){if(!this.hasAvailableMoves()){this.status="lose";let t=document.querySelector(".message-lose");t&&t.classList.remove("hidden")}}checkWin(){for(let t=0;t<4;t++)for(let e=0;e<4;e++)if(2048===this.board[t][e]){this.status="win";let t=document.querySelector(".message-win");t&&t.classList.remove("hidden");return}}hasAvailableMoves(){for(let t=0;t<4;t++)for(let e=0;e<4;e++)if(0===this.board[t][e]||e<3&&this.board[t][e]===this.board[t][e+1]||t<3&&this.board[t][e]===this.board[t+1][e])return!0;return!1}isBoardChanged(t,e){for(let s=0;s<4;s++)for(let r=0;r<4;r++)if(t[s][r]!==e[s][r])return!0;return!1}transpose(t){return t[0].map((e,s)=>t.map(t=>t[s]))}animateCell(t,e){let s=document.querySelector(`.field-row:nth-child(${t+1}) .field-cell:nth-child(${e+1})`);s&&(s.classList.add("new-cell"),setTimeout(()=>s.classList.remove("new-cell"),500))}};document.addEventListener("DOMContentLoaded",()=>{let e=document.querySelector(".message-start"),s=document.querySelector(".button.start");function r(){let e=t.getState();document.querySelectorAll(".field-cell").forEach((t,s)=>{let r=e[Math.floor(s/4)][s%4];t.className="field-cell",r?(t.classList.add(`field-cell--${r}`),t.textContent=r):t.textContent=""}),document.querySelector(".game-score").textContent=t.getScore()}s.addEventListener("click",()=>{"playing"===t.getStatus()||"lose"===t.getStatus()?(t.restart(),s.textContent="Start",s.classList.remove("restart"),e&&e.classList.remove("hidden")):(t.start(),s.textContent="Restart",s.classList.add("restart"),e&&e.classList.add("hidden")),r()}),document.addEventListener("keydown",e=>{if("playing"===t.getStatus()){switch(e.key){case"ArrowLeft":t.moveLeft();break;case"ArrowRight":t.moveRight();break;case"ArrowUp":t.moveUp();break;case"ArrowDown":t.moveDown()}t.moved&&r()}}),r()});
//# sourceMappingURL=index.776312f2.js.map
